<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>অ্যাডমিন প্যানেল</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;700&display=swap');
        @import url("https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css");
        :root {
            --primary-gradient: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            --danger-gradient: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            --secondary-color: #fdd835;
            --bg-color: #121212;
            --container-bg: rgba(30, 30, 50, 0.3);
            --card-bg: rgba(255, 255, 255, 0.05);
            --border-color: rgba(255, 255, 255, 0.1);
            --text-primary: #f0f0f0;
            --text-secondary: #b0b0b0;
        }
        body {
            font-family: 'Noto Sans Bengali', sans-serif;
            color: var(--text-primary);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
            background: linear-gradient(45deg, #1e133b, #3b1f4a, #1e3a8a, #4f46e5);
            background-size: 400% 400%;
            animation: gradientBG 25s ease infinite;
        }
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .container {
            width: 100%; max-width: 1200px; background: var(--container-bg); backdrop-filter: blur(20px);
            border-radius: 24px; border: 1px solid var(--border-color); padding: 32px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37); text-align: center;
        }
        #login-container { max-width: 400px; margin-top: 50px; }
        .admin-section { margin-bottom: 25px; background: var(--card-bg); padding: 15px; border-radius: 16px; text-align: left; }
        .admin-section h3 { border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-top: 0; }
        .admin-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .admin-table th, .admin-table td { padding: 10px; border: 1px solid var(--border-color); text-align: left; }
        .admin-table th { background: rgba(0,0,0,0.2); }
        .admin-table button, .btn {
            padding: 6px 12px; font-size: 12px; margin: 2px; width: auto; border-radius: 8px; cursor: pointer;
            border: 1px solid transparent; color: white;
        }
        .btn-primary { background: var(--primary-gradient); }
        .btn-danger { background: var(--danger-gradient); }
        .btn-approve { background: linear-gradient(135deg, #28a745, #218838); }
        .btn-reject { background: linear-gradient(135deg, #dc3545, #c82333); }
        .hidden { display: none; }
        input {
            width: 100%; padding: 14px; margin-bottom: 12px; border-radius: 12px; border: 1px solid var(--border-color);
            background-color: rgba(0,0,0,0.2); color: var(--text-primary); box-sizing: border-box; font-size: 16px;
        }
        label { display: block; text-align: left; margin: 10px 0 5px; }
    </style>
</head>
<body>
    
    <div class="container" id="login-container">
        <h2>অ্যাডমিন লগইন</h2>
        <input type="password" id="admin-password" placeholder="পাসওয়ার্ড দিন">
        <button class="btn btn-primary" style="width:100%; font-size: 16px;" onclick="login()">লগইন করুন</button>
    </div>

    <div class="container hidden" id="admin-panel">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h2><i class="fas fa-cogs"></i> সুপার অ্যাডমিন প্যানেল</h2>
            <button class="btn btn-danger" onclick="logout()">লগ আউট</button>
        </div>
        
        <div class="admin-section">
            <h3><i class="fas fa-users"></i> ব্যবহারকারী ম্যানেজমেন্ট</h3>
            <div style="overflow-x:auto;">
                <table class="admin-table" id="admin-users-table"></table>
            </div>
        </div>

        <div class="admin-section">
            <h3><i class="fas fa-hand-holding-usd"></i> উত্তোলনের অনুরোধ</h3>
             <div style="overflow-x:auto;">
                <table class="admin-table" id="admin-withdrawals-table"></table>
            </div>
        </div>

        <div class="admin-section">
            <h3><i class="fas fa-headset"></i> সহায়তা টিকেট</h3>
             <div style="overflow-x:auto;">
                <table class="admin-table" id="admin-tickets-table"></table>
            </div>
        </div>

        <div class="admin-section">
            <h3><i class="fas fa-sliders-h"></i> সাধারণ সেটিংস</h3>
            <label for="setting-notice-text">নোটিশ টেক্সট:</label>
            <input type="text" id="setting-notice-text">
            <label for="setting-ad-price">প্রতি বিজ্ঞাপনের মূল্য (পয়েন্ট):</label>
            <input type="number" id="setting-ad-price" step="0.1">
            <label for="setting-min-withdraw">সর্বনিম্ন উত্তোলন (পয়েন্ট):</label>
            <input type="number" id="setting-min-withdraw">
            <label for="setting-withdraw-status">উত্তোলন সিস্টেম:</label>
            <select id="setting-withdraw-status" style="width:100%; padding: 14px; background-color: rgba(0,0,0,0.2); color: var(--text-primary); border-radius: 12px; border: 1px solid var(--border-color);">
                <option value="enabled">চালু (Enabled)</option>
                <option value="disabled">বন্ধ (Disabled)</option>
            </select>
            <button class="btn btn-primary" style="margin-top:15px; width: 100%; font-size: 16px;" onclick="saveAdminSettings()">সেটিংস সেভ করুন</button>
        </div>
    </div>

    <script>
        // --- Shared Database Functions ---
        function getDatabase() {
            const dbString = localStorage.getItem('app_database_v2');
            if (dbString) { return JSON.parse(dbString); }
            return { users: {}, withdrawals: [], supportTickets: [], settings: { adPrice: 0.5, minWithdraw: 50, noticeText: "স্বাগতম!", withdrawStatus: "enabled" } };
        }
        function saveDatabase(db) {
            localStorage.setItem('app_database_v2', JSON.stringify(db));
        }

        // --- Admin Panel Logic ---
        const ADMIN_PASSWORD = "admin123"; // এই পাসওয়ার্ড পরিবর্তন করতে পারেন

        document.addEventListener('DOMContentLoaded', () => {
            if (sessionStorage.getItem('adminLoggedIn') === 'true') {
                showAdminPanel();
            }
        });

        function login() {
            const pass = document.getElementById('admin-password').value;
            if (pass === ADMIN_PASSWORD) {
                sessionStorage.setItem('adminLoggedIn', 'true');
                showAdminPanel();
            } else {
                alert("ভুল পাসওয়ার্ড!");
            }
        }

        function logout() {
            sessionStorage.removeItem('adminLoggedIn');
            document.getElementById('admin-panel').classList.add('hidden');
            document.getElementById('login-container').classList.remove('hidden');
        }
        
        function showAdminPanel() {
             document.getElementById('login-container').classList.add('hidden');
             document.getElementById('admin-panel').classList.remove('hidden');
             renderAdminData();
        }

        function renderAdminData() {
            if (sessionStorage.getItem('adminLoggedIn') !== 'true') return;
            renderUsersTable();
            renderWithdrawalsTable();
            renderTicketsTable();
            loadAdminSettings();
        }
        
        function renderUsersTable() {
            const db = getDatabase();
            const table = document.getElementById('admin-users-table');
            let html = `<thead><tr><th>ID & জয়েন</th><th>পয়েন্ট</th><th>বিজ্ঞাপন</th><th>স্ট্যাটাস</th><th>অ্যাকশন</th></tr></thead><tbody>`;
            for(const userId in db.users) {
                const user = db.users[userId];
                html += `<tr>
                    <td><b>${user.id}</b><br><small>${new Date(user.createdAt).toLocaleDateString('bn-BD')}</small></td>
                    <td>${user.points.toFixed(2)}</td>
                    <td>${user.watchedAds}</td>
                    <td>${user.isBanned ? '<span style="color:red;">Banned</span>' : '<span style="color:lime;">Active</span>'}</td>
                    <td>
                        <button onclick="adjustPoints('${userId}')">পয়েন্ট অ্যাডজাস্ট</button>
                        <button class="btn-danger" onclick="toggleBanUser('${userId}')">${user.isBanned ? 'আনব্যান' : 'ব্যান'}</button>
                    </td>
                </tr>`;
            }
            table.innerHTML = html + '</tbody>';
        }

        function renderWithdrawalsTable() {
            const db = getDatabase();
            const table = document.getElementById('admin-withdrawals-table');
            let html = `<thead><tr><th>User ID</th><th>পরিমাণ</th><th>মাধ্যম/নম্বর</th><th>স্ট্যাটাস</th><th>তারিখ</th><th>অ্যাকশন</th></tr></thead><tbody>`;
            db.withdrawals.slice().reverse().forEach(w => {
                 html += `<tr>
                    <td>${w.userId}</td>
                    <td>${w.amount.toFixed(2)}</td>
                    <td><b>${w.method}</b><br>${w.phone}</td>
                    <td style="font-weight: bold; color: ${w.status === 'pending' ? 'orange' : (w.status === 'approved' ? 'lime' : 'red')}">${w.status}</td>
                    <td>${new Date(w.date).toLocaleString('bn-BD')}</td>
                    <td>
                        ${w.status === 'pending' ? `
                        <button class="btn-approve" onclick="updateWithdrawalStatus('${w.id}', 'approved')">Approve</button>
                        <button class="btn-reject" onclick="updateWithdrawalStatus('${w.id}', 'rejected')">Reject</button>
                        ` : 'N/A'}
                    </td>
                </tr>`;
            });
            table.innerHTML = html + '</tbody>';
        }

        function renderTicketsTable() {
            const db = getDatabase();
            const table = document.getElementById('admin-tickets-table');
            let html = `<thead><tr><th>User ID</th><th>ধরণ</th><th>বিবরণ</th><th>স্ট্যাটাস</th><th>তারিখ</th><th>অ্যাকশন</th></tr></thead><tbody>`;
            db.supportTickets.slice().reverse().forEach(t => {
                 html += `<tr>
                    <td>${t.userId}</td>
                    <td>${t.type}</td>
                    <td style="max-width: 250px; white-space: pre-wrap; word-break: break-word;">${t.description}</td>
                    <td style="font-weight: bold; color: ${t.status === 'open' ? 'orange' : 'lime'}">${t.status}</td>
                    <td>${new Date(t.date).toLocaleString('bn-BD')}</td>
                    <td>
                        ${t.status === 'open' ? `<button onclick="updateTicketStatus('${t.id}', 'closed')">Close Ticket</button>` : 'N/A'}
                    </td>
                </tr>`;
            });
            table.innerHTML = html + '</tbody>';
        }

        function loadAdminSettings() {
            const db = getDatabase();
            document.getElementById('setting-notice-text').value = db.settings.noticeText;
            document.getElementById('setting-ad-price').value = db.settings.adPrice;
            document.getElementById('setting-min-withdraw').value = db.settings.minWithdraw;
            document.getElementById('setting-withdraw-status').value = db.settings.withdrawStatus;
        }

        function saveAdminSettings() {
            let db = getDatabase();
            db.settings.noticeText = document.getElementById('setting-notice-text').value;
            db.settings.adPrice = parseFloat(document.getElementById('setting-ad-price').value);
            db.settings.minWithdraw = parseInt(document.getElementById('setting-min-withdraw').value);
            db.settings.withdrawStatus = document.getElementById('setting-withdraw-status').value;
            saveDatabase(db);
            alert("সেটিংস সফলভাবে সেভ হয়েছে!");
            renderAdminData();
        }

        function adjustPoints(userId) {
            const amount = parseFloat(prompt(`ইউজার ${userId} এর জন্য পয়েন্ট যোগ করতে (+) বা বিয়োগ করতে (-) সংখ্যা লিখুন:\n(যেমন: 50 অথবা -50)`));
            if (!isNaN(amount)) {
                let db = getDatabase();
                db.users[userId].points += amount;
                saveDatabase(db);
                renderUsersTable();
            }
        }

        function toggleBanUser(userId) {
            if (confirm(`আপনি কি সত্যিই এই ব্যবহারকারীর ব্যানের স্থিতি পরিবর্তন করতে চান?`)) {
                let db = getDatabase();
                db.users[userId].isBanned = !db.users[userId].isBanned;
                saveDatabase(db);
                renderUsersTable();
            }
        }
        
        function updateWithdrawalStatus(withdrawalId, newStatus) {
            if (confirm(`আপনি কি নিশ্চিত যে এই অনুরোধটি '${newStatus}' করতে চান?`)) {
                let db = getDatabase();
                const withdrawal = db.withdrawals.find(w => w.id === withdrawalId);
                if (withdrawal) {
                    // যদি অনুরোধ বাতিল করা হয়, তবে ব্যবহারকারীকে পয়েন্ট ফেরত দিন
                    if (newStatus === 'rejected' && withdrawal.status === 'pending') {
                        db.users[withdrawal.userId].points += withdrawal.amount;
                    }
                    withdrawal.status = newStatus;
                    saveDatabase(db);
                    renderWithdrawalsTable();
                    renderUsersTable(); // পয়েন্ট ফেরত দিলে ব্যবহারকারী টেবিল আপডেট হবে
                }
            }
        }

        function updateTicketStatus(ticketId, newStatus) {
             if (confirm(`আপনি কি নিশ্চিত যে এই টিকেটটি '${newStatus}' করতে চান?`)) {
                let db = getDatabase();
                const ticket = db.supportTickets.find(t => t.id === ticketId);
                if (ticket) {
                    ticket.status = newStatus;
                    saveDatabase(db);
                    renderTicketsTable();
                }
            }
        }
    </script>
</body>
</html>
